<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Lucidify EEG Viewer (Prototype)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Lucidify EEG Viewer</h1>
  </header>

  <main>
    <section id="file-section">
      <h2>Load Recording</h2>
      <input
        type="file"
        id="file-input"
        accept=".edf"
      />
      <p id="file-info"></p>
	  <button id="save-view-button" disabled>Save view as EDF</button>
    </section>

	<section id="views" class="hidden">
	<h2>Views</h2>
	
	<div id="waveform-container">
		<div id="waveform-row">
		<div id="zoom-column">
		  <div id="zoom-slider-wrapper">
			<input type="range" id="zoom-slider" min="0" max="100" value="0" />
		  </div>
		  <div class="zoom-label">Zoom</div>
		</div>

		<div id="waveform-section" class="viz-section">
		  <div class="section-overlay hidden"><div class="loading-text">[...loading...]</div></div>

		  <h3>Waveform</h3>
		  <div id="waveform-controls"></div>
		  <canvas id="waveform-canvas"></canvas>
		</div>
		</div>
	
		<div id="pan-row">
		<div id="pan-track">
			<div id="pan-thumb"></div>
		</div>
		<div id="time-label"></div>
		</div>
	</div>
	
	<h3>Spectrogram</h3>

	<div id="spectrogram-section" class="viz-section">
	  <div class="section-overlay hidden"><div class="loading-text">[...loading...]</div></div>

	  <div id="spectrogram-meta">
		<span id="freq-range-label"></span>
	  </div>

		<div id="spectrogram-controls" class="controls-row">
		  <button id="spectrogram-refresh-button" class="refresh-button" title="Refresh spectrogram" aria-label="Refresh spectrogram">⟳</button>
		  <div id="spectrogram-channel-controls"></div>
		</div>
        <canvas id="spectrogram-canvas" width="800" height="240"></canvas>
	</div>

	<h3>Hypnogram</h3>

	<div id="hypnogram-section" class="viz-section">
	  <div class="section-overlay hidden"><div class="loading-text">[...loading...]</div></div>
		<div id="hypnogram-controls" class="controls-row">
		  <button
			id="hypnogram-refresh-button"
			class="refresh-button"
			title="Refresh hypnogram"
			aria-label="Refresh hypnogram"
		  >
			⟳
		  </button>

		  <label class="hmm-toggle" title="Apply HMM smoothing">
			<input type="checkbox" id="hypnogram-hmm-checkbox" checked />
			<span>HMM</span>
		  </label>

		  <div id="hypnogram-channel-controls"></div>
		</div>
	  <canvas id="hypnogram-canvas" width="800" height="120"></canvas>
	  		  <div id="hypnogram-text">
		  This hypnogram is generated by a selectable sleep staging model using 30-second EEG epochs and spectral features to predict W, N1, N2, N3, REM. Two Lucidify models are provided: one trained on PhysioNet Sleep-EDF, and one trained on OpenNeuro BOAS. Because these datasets differ in sensors, channel placement, recording hardware, filtering, noise characteristics, and subject populations, outputs can differ noticeably when applied outside the training domain. Optional HMM smoothing can reduce rapid, improbable stage changes.

Reference overlay (validation): Use Load Ref to load a reference hypnogram and overlay it on the current model output. Supported formats:

PhysioNet Sleep-EDF: *-Hypnogram.edf (EDF+ annotations)

OpenNeuro / BIDS: *_events.tsv (choose stage_hum when available; stage_ai is automatic scoring and may not be human ground truth)

The overlay line is drawn on the current view window and stage agreement metrics (accuracy / Cohen’s kappa) are reported for the overlapping epochs.

YASA: A third option uses a JavaScript port of YASA (Yet Another Spindle Algorithm / sleep staging). YASA is a third-party open-source project; see the included YASA README and license for details, attribution, and permitted use. The YASA implementation and model export are provided “as-is” and should be independently validated for clinical or regulated use.

Copyright / Notice: © 2025 Lucidify. All rights reserved. Portions of this software incorporate third-party open-source components (including YASA) under their respective licenses; consult the linked license texts for terms.</div>
	<div class="hypno-links">
  Links:
  <a href="yasa/README.md" target="_blank" rel="noopener">YASA README</a> ·
  <a href="yasa/LICENCE.txt" target="_blank" rel="noopener">YASA License</a> ·
  <a href="docs/overlay.html" target="_blank" rel="noopener">Reference Overlay Help</a>
</div><div class="hypno-datasets">
  Datasets:
  <a href="https://www.physionet.org/content/sleep-edfx/1.0.0/" target="_blank" rel="noopener">
    PhysioNet Sleep-EDF Expanded (sleep-edfx)
  </a>
  ·
  <a href="https://openneuro.org/datasets/ds005555/versions/1.1.0" target="_blank" rel="noopener">
    OpenNeuro BOAS (ds005555)
  </a>
</div>

<div class="hypno-citations">
  DOIs:
  <a href="https://doi.org/10.13026/C2X676" target="_blank" rel="noopener">Sleep-EDF Expanded</a>
  ·
  <a href="https://doi.org/10.18112/openneuro.ds005555.v1.1.0" target="_blank" rel="noopener">BOAS v1.1.0</a>
</div></div>

</section>
  </main>
	<div id="loading-overlay" class="hidden">
	  <div class="loading-text">[...loading...]</div>
	</div>
	<script src="edf_parser.js"></script>
	<script src="renderers.js"></script>
	<script src="large_edf_segment_loader.js"></script>
	<script src="edf_writer.js"></script>

	<script src="sleep_models_embedded.js"></script>
	<script src="sleep_local_bundle.js"></script>
    <script src="hypnogram_reference.js"></script>
	<script src="hypnogram_renderer.js"></script>
	<!-- YASA engine (new set) -->
	<script src="yasa/yasa_model_dump_embedded.js"></script>
	<script src="yasa/yasa_dsp.js"></script>
	<script src="yasa/yasa_features.js"></script>
	<script src="yasa/yasa_lgbm.js"></script>
	<script src="yasa/yasa_staging.js"></script>

	<!-- Adapter that defines window.LucidifyYasaSleepStage -->
	<script src="yasa/yasa_sleep_stage.js"></script>

	<script src="main.js"></script>

</body>
</html>
